



<!DOCTYPE html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Site web décentralisé utilisant Bitcoin crypto et BitTorrent protocole">
      
      
        <link rel="canonical" href="https://github.com/HelloZeroNet/ZeroNet/fr/help_zeronet/network_protocol/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copier dans le presse-papier">
      
        <meta name="lang:clipboard.copied" content="Copié dans le presse-papier">
      
        <meta name="lang:search.language" content="fr">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="Aucun document trouvé">
      
        <meta name="lang:search.result.one" content="1 document trouvé">
      
        <meta name="lang:search.result.other" content="# documents trouvés">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../logo/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>ZeroNet network protocol - ZeroNet</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../docs.css">
    
      <link rel="stylesheet" href="../../../stylesheets/menu.css">
    
      <link rel="stylesheet" href="../../../stylesheets/bitcoinbar.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#zeronet-network-protocol" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/HelloZeroNet/ZeroNet" title="ZeroNet" class="md-header-nav__button md-logo">
          
            <img src="../../../logo/zeronet_logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ZeroNet
              </span>
              <span class="md-header-nav__topic">
                ZeroNet network protocol
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Taper pour démarrer la recherche
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/HelloZeroNet/ZeroNet/" title="Aller au dépôt" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          <div class="md-source" style="cursor: pointer;">
            <div id="translation" class="md-source__icon" onClick="translationClicked(event)">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
               <path fill="white" d="M18.604 16.111c.018.276.048.531.092.758-.583.106-.606-.469-.092-.758zm-4.354.16h.996l-.498-1.43-.498 1.43zm2.75-6.105c3.697 0 7 2.465 7 5.837 0 1.196-.432 2.37-1.193 3.281-.033 1.068.596 2.6 1.162 3.715-1.518-.274-3.676-.88-4.654-1.48-5.387 1.313-9.315-1.984-9.315-5.516 0-3.39 3.326-5.837 7-5.837zm-.437 7.584l-1.44-3.792h-.76l-1.447 3.792h.812l.312-.875h1.422l.313.875h.788zm3.988-2.296l.079-.353-.642-.125-.064.292c-.215-.032-.445-.036-.679-.012l.028-.458h.717v-.608h-.631l.084-.335-.627-.188c-.046.154-.084.304-.123.523h-.715v.608h.638c-.018.196-.026.399-.03.605-.704.259-1.002.751-1.002 1.198 0 .528.416.992 1.074.932.817-.074 1.362-.691 1.682-1.45.332.19.471.511.346.807-.115.275-.455.536-1.104.523v.654c.721.011 1.429-.262 1.707-.923.27-.647-.041-1.352-.738-1.69zm-1.25 1.073c.17-.177.305-.401.407-.626-.147-.013-.306-.009-.462.012.011.22.028.425.055.614zm-10.492 2.703c-1.887-.271-3.571-1.165-4.827-2.478-.182-.189-.315-.636-.019-.819l.302-.078c.235-.199-.221-1.009-.04-1.14.561-.401.295-.893-.051-1.299-.146-.172-.948-1-1.038-.853.067-.226-.146-.772-.274-.987-.217-.362-.502-.585-.617-.982-.046-.158-.046-.64-.139-.751-.038-.045-.327-.167-.317-.233.278-1.655 1.044-3.143 2.149-4.318l.746-.301c.468-.703.495-.158.916-.341.141 0 .301-.578.452-.667.261-.169.062-.169.013-.245-.104-.168 2.191-1.003 2.229-.853.032.127-1.135.734-1.007.716-.296.039-.352.571-.297.568.147-.005 1.074-.704 1.506-.555.423.146 1.183-.336 1.48-.582.149-.125.286-.344.483-.344.909 0 2.268.374 2.579.56.474.283-.204.263-.277.447-.058.142-.19.335-.249.412-.102.133-.399.077-.341-.082.059-.167.348-.231-.086-.271-.445-.041-.568-.341-1.014.034-.134.113-.234.286-.321.433-.123.21-.42.201-.544.396-.12.192.07.512.304.371.062-.038.765.645.674.095-.059-.364.196-.612.201-.887.003-.184.28-.066.206.03-.097.121-.203.534.051.554.096.008.339-.158.425-.084-.096-.002-.315.383-.3.376-.108.048-.233-.021-.15.21.074.228-.408.201-.495.247-.037.02-.417-.114-.408-.028-.131-.109.037-.379-.072-.422-.11.168-.058.512-.294.512-.202 0-.482.229-.604.369-.087.097-.609.308-.666.302.299.031.286.25.261.437-.06.433-.995.032-.956.196.038.158-.107.586-.139.724-.029.125.402.205.378.267.002-.007.583-.199.64-.25l.131-.293c.11-.073.226-.133.35-.179l.149-.258c.05-.02.645-.112.686-.092.149.068.428.353.532.483.036.047.227.117.227.188.069.107-.051.148-.006.223.104.193.132-.401.087-.29 0-.189.142.071.174.049l-.657-.654c-.204-.342.543.183.64.247.096.063.285.629.537.501.158-.08-.004-.139.106-.229l.449-.09c-.357.261.279.602.182.556.16.074.254-.058.354-.021.057.022.663.015.566-.082.151.076.082.748-.044.851-.204.169-1.182.1-1.399-.057-.361-.262-.297.279-.473.352-.344.142-.857-.463-1.218-.482.176.026.015-.445.015-.478-.139-.171-1.02.019-1.252.05-.434.058-.89.052-1.223.324-.234.189-.237.5-.477.651-.156.095-.325.064-.456.189-.234.222-.504.552-.637.845-.054.123.072.416.041.574-.307.967.076 2.308 1.248 2.456.25.032.506.144.759.117 1.332-2.88 4.568-4.92 8.347-4.92.932 0 1.831.124 2.678.354-1.105-4.322-5.012-7.521-9.678-7.521-5.523 0-10 4.477-10 10s4.477 10 10 10l.074-.004c-.509-.533-.931-1.128-1.265-1.766zm4.778-13.035c.068-.008-.089.138-.089.138.027.212.183.327.479.435.36.129.03.375-.176.317-.114-.032-.704-.21-.725.021 0 .138-.56.001-.473-.145.061-.098.041-.319.152-.464.16-.21.313-.096.318.026.002.327.332-.306.514-.328zm-4.532-.292c.08.113.688-.163.591-.146.187-.094.024-.104-.082-.159-.035-.179-.065-.456-.177-.566l.074-.085c-.173-.249-.301.302-.301.302l.09-.026-.042.113c.071.129.019.207.007.277l-.124.077c-.045.055.215.062.217.071.009.028-.313.074-.253.142zm-.396-.286c-.069.071.002.116.073.085.104-.045.244-.044.26-.183l.066-.084c.029-.043-.057-.114-.092-.121l-.124.086-.061.016-.056.072.006.04-.072.089zm2.634 2.107c-.055 0-.369.029-.34.084.178.293.403-.076.34-.084z"></path>
              </svg>
              <span style="text-transform: uppercase;">fr</span>
              <svg id="menuDropUp" style="margin-left:0; display: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7 14l5-5 5 5z" fill="white"/><path d="M0 0h24v24H0z" fill="none"/></svg>
              <svg id="menuDropDown" style="margin-left:0;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z" fill="white"/><path d="M0 0h24v24H0z" fill="none"/></svg>
            </div>
          </div>
          <div id="translationMenu" style="display: none;" class="md-menu" tabindex="-1">
            <ul class="md-list" role="menu" aria-hidden="true" aria-orientation="vertical">
              <li class="md-list-item" role="menuitem">
                <a class="md-list-item__text" href="" onClick="goToTranslation(event, 'fr' ,'en')">English</a>
              </li>
              <li class="md-list-item" role="menuitem">
                <a class="md-list-item__text" href="" onClick="goToTranslation(event, 'fr' ,'fr')">Français</a>
              </li>
              <span class="md-divider"></span>
              <li class="md-list-item" role="menuitem">
                <a class="md-list-item__text" href="/fr/translation">Translation HowTo</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../" title="Introduction" class="md-tabs__link">
        Introduction
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../using_zeronet/installing/" title="Commencer à utiliser ZeroNet" class="md-tabs__link">
          Commencer à utiliser ZeroNet
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../site_development/getting_started/" title="Commencer à déveloper" class="md-tabs__link">
          Commencer à déveloper
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../contributing/" title="Contribuer à ZeroNet" class="md-tabs__link md-tabs__link--active">
          Contribuer à ZeroNet
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://github.com/HelloZeroNet/ZeroNet" title="ZeroNet" class="md-nav__button md-logo">
      
        <img src="../../../logo/zeronet_logo.svg" width="48" height="48">
      
    </a>
    ZeroNet
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/HelloZeroNet/ZeroNet/" title="Aller au dépôt" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="Questions Fréquentes" class="md-nav__link">
      Questions Fréquentes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Commencer à utiliser ZeroNet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Commencer à utiliser ZeroNet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../using_zeronet/installing/" title="Installing ZeroNet" class="md-nav__link">
      Installing ZeroNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../using_zeronet/sample_sites/" title="Sample ZeroNet sites" class="md-nav__link">
      Sample ZeroNet sites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../using_zeronet/create_new_site/" title="Create new ZeroNet site" class="md-nav__link">
      Create new ZeroNet site
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Commencer à déveloper
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Commencer à déveloper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../site_development/getting_started/" title="Commencer" class="md-nav__link">
      Commencer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../site_development/zeroframe_api_reference/" title="ZeroFrame API Reference" class="md-nav__link">
      ZeroFrame API Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../site_development/content_json/" title="Structure of content.json" class="md-nav__link">
      Structure of content.json
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../site_development/dbschema_json/" title="Structure of dbschema.json" class="md-nav__link">
      Structure of dbschema.json
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../site_development/cert_authority/" title="Certificate Authority" class="md-nav__link">
      Certificate Authority
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Contribuer à ZeroNet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Contribuer à ZeroNet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing to ZeroNet" class="md-nav__link">
      Contributing to ZeroNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../coding_conventions/" title="Coding standards if you want to collaborate to ZeroNet" class="md-nav__link">
      Coding standards if you want to collaborate to ZeroNet
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="ZeroNet network protocol" class="md-nav__link md-nav__link--active">
      ZeroNet network protocol
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../donate/" title="Contribution financière" class="md-nav__link">
      Contribution financière
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/HelloZeroNet/Documentation/edit/master/docs/fr/help_zeronet/network_protocol.md" title="Editer cette page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="zeronet-network-protocol">ZeroNet network protocol<a class="headerlink" href="#zeronet-network-protocol" title="Permanent link">&para;</a></h1>
<ul>
<li>Every message is encoded using <a href="http://msgpack.org/">MessagePack</a></li>
<li>Every request has 3 parameter:<ul>
<li><code>cmd</code>: The request command</li>
<li><code>req_id</code>: The request's unique id (simple, incremented nonce per-connection), the client has to include this when reply to the command.</li>
<li><code>params</code>: Parameters for the request</li>
</ul>
</li>
<li>Example request: <code>{"cmd": "getFile", "req_id": 1, "params:" {"site": "1EU...", "inner_path": "content.json", "location": 0}}</code></li>
<li>Example response: <code>{"cmd": "response", "to": 1, "body": "content.json content", "location": 1132, "size": 1132}</code></li>
<li>Example error response: <code>{"cmd": "response", "to": 1, "error": "Unknown site"}</code></li>
</ul>
<h1 id="handshake">Handshake<a class="headerlink" href="#handshake" title="Permanent link">&para;</a></h1>
<p>Every connection begins with a handshake by sending a request to the target network address:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>crypt</strong></td>
<td>Null/None, only used in respones</td>
</tr>
<tr>
<td><strong>crypt_supported</strong></td>
<td>An array of connection encryption methods supported by the client</td>
</tr>
<tr>
<td><strong>fileserver_port</strong></td>
<td>The client's fileserver port</td>
</tr>
<tr>
<td><strong>onion</strong></td>
<td>(Only used on tor) The client's onion address</td>
</tr>
<tr>
<td><strong>protocol</strong></td>
<td>The protocol version the client uses (v1 or v2)</td>
</tr>
<tr>
<td><strong>port_opened</strong></td>
<td>The client's client port open status</td>
</tr>
<tr>
<td><strong>peer_id</strong></td>
<td>(Not used on tor) The client's peer_id</td>
</tr>
<tr>
<td><strong>rev</strong></td>
<td>The client's revision number</td>
</tr>
<tr>
<td><strong>version</strong></td>
<td>The client's version</td>
</tr>
<tr>
<td><strong>target_ip</strong></td>
<td>The server's network address</td>
</tr>
</tbody>
</table>
<p>The target initialize the encryption on the socket based on <code>crypt_supported</code>, then return:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>crypt</strong></td>
<td>The encryption to use</td>
</tr>
<tr>
<td><strong>crypt_supported</strong></td>
<td>An array of connection encryption methods supported by the server</td>
</tr>
<tr>
<td><strong>fileserver_port</strong></td>
<td>The server's fileserver port</td>
</tr>
<tr>
<td><strong>onion</strong></td>
<td>(Only used on tor) The server's onion address</td>
</tr>
<tr>
<td><strong>protocol</strong></td>
<td>The protocol version the server uses (v1 or v2)</td>
</tr>
<tr>
<td><strong>port_opened</strong></td>
<td>The server's client port open status</td>
</tr>
<tr>
<td><strong>peer_id</strong></td>
<td>(Not used on tor) The server's peer_id</td>
</tr>
<tr>
<td><strong>rev</strong></td>
<td>The server's revision number</td>
</tr>
<tr>
<td><strong>version</strong></td>
<td>The server's version</td>
</tr>
<tr>
<td><strong>target_ip</strong></td>
<td>The client's network address</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> No encryption used on .onion connections, as the Tor network provides the transport security by default.
<strong>Note:</strong> You can also implicitly initialize SSL before the handshake if you can assume it supported by remote client.</p>
</blockquote>
<p><strong>Example</strong>:</p>
<p>Sent handshake:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;handshake&quot;</span><span class="p">,</span>
  <span class="nt">&quot;req_id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;crypt&quot;</span><span class="p">:</span> <span class="err">None</span><span class="p">,</span>
    <span class="nt">&quot;crypt_supported&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tls-rsa&quot;</span><span class="p">],</span>
    <span class="nt">&quot;fileserver_port&quot;</span><span class="p">:</span> <span class="mi">15441</span><span class="p">,</span>
    <span class="nt">&quot;onion&quot;</span><span class="p">:</span> <span class="s2">&quot;zp2ynpztyxj2kw7x&quot;</span><span class="p">,</span>
    <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;v2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;port_opened&quot;</span><span class="p">:</span> <span class="err">True</span><span class="p">,</span>
    <span class="nt">&quot;peer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;-ZN0056-DMK3XX30mOrw&quot;</span><span class="p">,</span>
    <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="mi">2122</span><span class="p">,</span>
    <span class="nt">&quot;target_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.13&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.5.6&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Return:</p>
<div class="codehilite"><pre><span></span>{
 &quot;protocol&quot;: &quot;v2&quot;,
 &quot;onion&quot;: &quot;boot3rdez4rzn36x&quot;,
 &quot;to&quot;: 0,
 &quot;crypt&quot;: None,
 &quot;cmd&quot;: &quot;response&quot;,
 &quot;rev&quot;: 2092,
 &quot;crypt_supported&quot;: [],
 &quot;target_ip&quot;: &quot;zp2ynpztyxj2kw7x.onion&quot;,
 &quot;version&quot;: &quot;0.5.5&quot;,
 &quot;fileserver_port&quot;: 15441,
 &quot;port_opened&quot;: False,
 &quot;peer_id&quot;: &quot;&quot;
}
</pre></div>


<h1 id="peer-requests">Peer requests<a class="headerlink" href="#peer-requests" title="Permanent link">&para;</a></h1>
<h4 id="getfile-site-inner_path-location-file_size">getFile <em>site</em>, <em>inner_path</em>, <em>location</em>, <em>[file_size]</em><a class="headerlink" href="#getfile-site-inner_path-location-file_size" title="Permanent link">&para;</a></h4>
<p>Request a file from the client</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
<tr>
<td><strong>inner_path</strong></td>
<td>File path relative to site directory</td>
</tr>
<tr>
<td><strong>location</strong></td>
<td>Request file from this byte (max 512 bytes got sent in a request, so you need multiple requests for larger files)</td>
</tr>
<tr>
<td><strong>file_size</strong></td>
<td>Total size of the requested file (optional)</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>body</strong></td>
<td>The requested file content</td>
</tr>
<tr>
<td><strong>location</strong></td>
<td>The location of the last byte sent</td>
</tr>
<tr>
<td><strong>size</strong></td>
<td>Total size of the file</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="streamfile-site-inner_path-location-file_size">streamFile <em>site</em>, <em>inner_path</em>, <em>location</em>, <em>[file_size]</em><a class="headerlink" href="#streamfile-site-inner_path-location-file_size" title="Permanent link">&para;</a></h4>
<p>Stream a file from the client</p>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>stream_bytes</strong></td>
<td>The length of file data after the MessagePack payload</td>
</tr>
</tbody>
</table>
<p>To avoid having python-msgpack serialize large binary strings, the file body is appended directly after the MessagePack payload. For example,</p>
<div class="codehilite"><pre><span></span>&gt; {&quot;cmd&quot;: &quot;streamFile&quot;, &quot;id&quot;: 1, &quot;inner_path&quot;: &quot;content.json&quot;, &quot;size&quot;: 1234}
&lt; {&quot;cmd&quot;: &quot;response&quot;, &quot;to&quot;: 1, &quot;stream_bytes&quot;: 1234}
&lt; content of the file
</pre></div>


<blockquote>
<p>ZeroNet implementation detail: For file segments larger than 256 kb, streaming is enabled by default.</p>
</blockquote>
<hr />
<h4 id="ping">ping<a class="headerlink" href="#ping" title="Permanent link">&para;</a></h4>
<p>Checks if the client is still alive</p>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>body</strong></td>
<td>Pong</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="pex-site-peers-need">pex <em>site</em>, <em>peers</em>, <em>need</em><a class="headerlink" href="#pex-site-peers-need" title="Permanent link">&para;</a></h4>
<p>Exchange peers with the client.
Peers packed to 6 bytes (4byte IP using inet_ntoa + 2byte for port)</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
<tr>
<td><strong>peers</strong></td>
<td>List of peers that the requester has (packed)</td>
</tr>
<tr>
<td><strong>peers_onion</strong></td>
<td>List of Tor Onion peers that the requester has (packed)</td>
</tr>
<tr>
<td><strong>need</strong></td>
<td>Number of peers the requester want</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>peers</strong></td>
<td>List of IPv4 peers he has for the site (packed)</td>
</tr>
<tr>
<td><strong>peers_onion</strong></td>
<td>List of Tor Onion peers for this site (packed)</td>
</tr>
</tbody>
</table>
<p>Each element in the <code>peers</code> list is a packed IPv4 address.</p>
<table>
<thead>
<tr>
<th>IP address</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>4 bytes</code></td>
<td><code>2 bytes</code></td>
</tr>
</tbody>
</table>
<p>Each element in the <code>peers_onion</code> list is a packed Tor Onion Service address.</p>
<table>
<thead>
<tr>
<th>B32-decoded onion address</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>binary_str[0:-2]</code></td>
<td><code>binary_str[-2:]</code></td>
</tr>
</tbody>
</table>
<p>To restore the onion address, pass the first part through <code>base64.b32encode</code> and append <code>.onion</code> to the return value.</p>
<hr />
<h4 id="update-site-inner_path-body-diffs">update <em>site</em>, <em>inner_path</em>, <em>body</em>, <em>[diffs]</em><a class="headerlink" href="#update-site-inner_path-body-diffs" title="Permanent link">&para;</a></h4>
<p>Update a site file.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
<tr>
<td><strong>inner_path</strong></td>
<td>File path relative to site directory</td>
</tr>
<tr>
<td><strong>body</strong></td>
<td>Full content of the updated content.json</td>
</tr>
<tr>
<td><strong>diffs</strong> (optional)</td>
<td><a href="#possible-diff-opcodes">Diff opcodes</a> for the modified files in the content.json</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ok</strong></td>
<td>Thanks message on successful update :)</td>
</tr>
</tbody>
</table>
<h5 id="diffs-format">Diffs format<a class="headerlink" href="#diffs-format" title="Permanent link">&para;</a></h5>
<p>A dict that contains the modifications</p>
<ul>
<li>Key: changed file's relative path to content.json (eg.: <code>data.json</code>)</li>
<li>Value: The list of diff opcodes for the file (eg.: <code>[['=', 5], ['+', '\nhello new line'], ['-', 6]]</code>)</li>
</ul>
<h5 id="possible-diff-opcodes">Possible diff opcodes:<a class="headerlink" href="#possible-diff-opcodes" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Opcode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>['=', number of same characters]</strong></td>
<td>Have not changed part of the file (eg.: <code>['=', 5]</code>)</td>
</tr>
<tr>
<td><strong>['+', new text]</strong></td>
<td>Added characters (eg.: <code>['+', '\nhello new line']</code>)</td>
</tr>
<tr>
<td><strong>['-', number of removed characters]</strong></td>
<td>Full content of the updated file (eg.: <code>['-', 6]</code>)</td>
</tr>
</tbody>
</table>
<p>After the update received, the client tries to patch the files using the diffs.
If it failes to match the sha hash provided by the content.json (had different version of the file) it automatically re-downloads the whole file from the sender of the update.</p>
<blockquote>
<p><strong>Note:</strong> The patches are limited to 30KB per file and only used for .json files</p>
</blockquote>
<hr />
<h4 id="listmodified-site-since">listModified <em>site</em>, <em>since</em><a class="headerlink" href="#listmodified-site-since" title="Permanent link">&para;</a></h4>
<p>Lists the content.json files modified since the given parameter. It used to fetch the site's user submitted content.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
<tr>
<td><strong>since</strong></td>
<td>List content.json files since this timestamp.</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>modified_files</strong></td>
<td>Key: content.json inner_path<br>Value: last modification date</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><span class="err">&gt;</span> <span class="err">zeronet.py</span> <span class="err">--silent</span> <span class="err">peerCmd</span> <span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span> <span class="mi">15441</span> <span class="err">listModified</span> <span class="s2">&quot;{&#39;site&#39;: &#39;1BLogC9LN4oPDcruNz3qo1ysa133E9AGg8&#39;, &#39;since&#39;: 1497507030}&quot;</span>
<span class="p">{</span>
  <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;response&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modified_files&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;data/users/1NM9k7VJfrb1UWw5agAvyRfSn3ws1wTJ5U/content.json&quot;</span><span class="p">:</span> <span class="mi">1497579272</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1QEfmMwKVxgR4rkREbdJYjgUmF3Zy8pwHt/content.json&quot;</span><span class="p">:</span> <span class="mi">1497565986</span><span class="p">,</span>
    <span class="nt">&quot;data/users/16NS3rBdW9zpLmLSQoD8nLTtNVsRFtVBhd/content.json&quot;</span><span class="p">:</span> <span class="mi">1497575039</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1CjXarXgvcNeCJ2nMQxUi4DRFWp3GEur2W/content.json&quot;</span><span class="p">:</span> <span class="mi">1497513808</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1L5rGDgTs4W2V7gekSvJNhKa7XaHkVwotD/content.json&quot;</span><span class="p">:</span> <span class="mi">1497615798</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1LWuc6JBhUGrKEAh1aPrPU85dEMcKmg3pS/content.json&quot;</span><span class="p">:</span> <span class="mi">1497594716</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1KdnTJVBGzEZrJppFZtzfG9chukuMv8xSb/content.json&quot;</span><span class="p">:</span> <span class="mi">1497584640</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1GMNmr2bDPbT4c8yVnyCoDHke52CNCdqAa/content.json&quot;</span><span class="p">:</span> <span class="mi">1497614188</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1GRm9rED83Tkfi3iWS9m3LWHiRpPZehWLd/content.json&quot;</span><span class="p">:</span> <span class="mi">1497827772</span><span class="p">,</span>
    <span class="nt">&quot;data/users/12Ugp53jiMdvj1Kxa1w7c2LcXUBdGPs1oK/content.json&quot;</span><span class="p">:</span> <span class="mi">1497692901</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1F6BMqittjWUStzUbRXm2kG2GQ3RdBLqFQ/content.json&quot;</span><span class="p">:</span> <span class="mi">1497571485</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1GgNo3CmxPd7n2pMSF3uyqf1XHvgtTUqCe/content.json&quot;</span><span class="p">:</span> <span class="mi">1497560829</span><span class="p">,</span>
    <span class="nt">&quot;data/users/16nArdxrSaNThNp83kL8E6NLL9WD98iUne/content.json&quot;</span><span class="p">:</span> <span class="mi">1497627929</span><span class="p">,</span>
    <span class="nt">&quot;data/users/16CAJkbfNRxNJq4aKdrZ2MSYFfFGvQ8JPi/content.json&quot;</span><span class="p">:</span> <span class="mi">1497664899</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1DrBS2sTD3BX5BBxG8eqYsxXSvGt9kc5HE/content.json&quot;</span><span class="p">:</span> <span class="mi">1497632000</span><span class="p">,</span>
    <span class="nt">&quot;data/users/19sggoAZ4hcorrrfWoFWP9rwfpVsL29cnZ/content.json&quot;</span><span class="p">:</span> <span class="mi">1497928134</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1NYpJupegoTXL4cFpkNdLNJ4XaAhTNhPe1/content.json&quot;</span><span class="p">:</span> <span class="mi">1497535771</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1R67TfYzNkCnh89EFfGmXn5LMb4hXaMRQ/content.json&quot;</span><span class="p">:</span> <span class="mi">1497691787</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1C9HXUYFSVafLxanwkaFPZRcRgCEGsj2Cn/content.json&quot;</span><span class="p">:</span> <span class="mi">1497572833</span><span class="p">,</span>
    <span class="nt">&quot;data/users/1LgoHzNGWeijeZbJ8a1YgGjMCnjaM4BWG/content.json&quot;</span><span class="p">:</span> <span class="mi">1497620232</span><span class="p">,</span>
    <span class="nt">&quot;content.json&quot;</span><span class="p">:</span> <span class="mi">1497623639</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<hr />
<h4 id="gethashfield-site">getHashfield <em>site</em><a class="headerlink" href="#gethashfield-site" title="Permanent link">&para;</a></h4>
<p>Get the client's downloaded <a href="#optional-file-id">optional file ids</a>.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>hashfield_raw</strong></td>
<td>Optional file ids encoded using <code>array.array("H", [1000, 1001..]).tostring()</code></td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><span class="err">&gt;</span> <span class="err">zeronet.py</span> <span class="err">--silent</span> <span class="err">peerCmd</span> <span class="mf">192.168</span><span class="err">.</span><span class="mf">1.13</span> <span class="mi">15441</span> <span class="err">getHashfield</span> <span class="err">&quot;</span><span class="p">{</span><span class="err">&#39;site&#39;:</span> <span class="err">&#39;1Gif7PqWTzVWDQ42Mo7np3zXmGAo3DXc7h&#39;</span><span class="p">}</span>
<span class="p">{</span>
  <span class="err">&#39;to&#39;:</span> <span class="err">1,</span>
  <span class="err">&#39;hashfield_raw&#39;:</span> <span class="err">&#39;iG\xde\x02\xc6o\r;...&#39;,</span>
  <span class="err">&#39;cmd&#39;:</span> <span class="err">&#39;response&#39;</span>
<span class="p">}</span>
</pre></div>


<hr />
<h4 id="sethashfield-site-hashfield_raw">setHashfield <em>site</em>, <em>hashfield_raw</em><a class="headerlink" href="#sethashfield-site-hashfield_raw" title="Permanent link">&para;</a></h4>
<p>Set the list of <a href="#optional-file-id">optional file ids</a> that the requester client has.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
<tr>
<td><strong>hashfield_raw</strong></td>
<td>Optional file ids encoded using <code>array.array("H", [1000, 1001..]).tostring()</code></td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ok</strong></td>
<td>Updated</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="findhashids-site-hash_ids">findHashIds <em>site</em>, <em>hash_ids</em><a class="headerlink" href="#findhashids-site-hash_ids" title="Permanent link">&para;</a></h4>
<p>Queries if the client know any peer that has the requested hash_ids</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Site address (example: 1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr)</td>
</tr>
<tr>
<td><strong>hash_ids</strong></td>
<td>List of optional file ids the client currently looking for</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>peers</strong></td>
<td>Key: Optional file id<br>Value: List of ipv4 peers encoded using <code>socket.inet_aton(ip) + struct.pack("H", port)</code></td>
</tr>
<tr>
<td><strong>peers_onion</strong></td>
<td>Key: Optional file id<br>Value: List of onion peers encoded using <code>base64.b32decode(onion.replace(".onion", "").upper()) + struct.pack("H", port)</code></td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><span class="err">&gt;</span> <span class="err">zeronet.py</span> <span class="err">--silent</span> <span class="err">peerCmd</span> <span class="mf">192.168</span><span class="err">.</span><span class="mf">1.13</span> <span class="mi">15441</span> <span class="err">findHashIds</span> <span class="s2">&quot;{&#39;site&#39;: &#39;1Gif7PqWTzVWDQ42Mo7np3zXmGAo3DXc7h&#39;, &#39;hash_ids&#39;: [59948, 29811]}&quot;</span>
<span class="p">{</span>
  <span class="err">&#39;to&#39;:</span> <span class="err">1,</span>
  <span class="err">&#39;peers&#39;:</span> <span class="err">{</span>
    <span class="err">29811:</span> <span class="err">[</span>
      <span class="err">&#39;S&amp;9\xd3Q&lt;&#39;,</span>
      <span class="err">&#39;&gt;f\x94\x98N\xa4&#39;,</span>
      <span class="err">&#39;gIB\x90Q&lt;&#39;,</span>
      <span class="err">&#39;\xb4\xady\xf7Q&lt;&#39;</span>
    <span class="err">],</span>
    <span class="err">59948:</span> <span class="err">[</span>
      <span class="err">&#39;x\xcc&gt;\xf6Q&lt;&#39;,</span>
      <span class="err">&#39;S\xa1\xddkQ&lt;&#39;,</span>
      <span class="err">&#39;\x05\xac\xe8\x8dQ&lt;&#39;,</span>
      <span class="err">&#39;\x05\xc4\xe1\x93Q&lt;&#39;,</span>
      <span class="err">&#39;Q\x02\xed\nQ&lt;&#39;</span>
    <span class="err">]</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="err">&#39;cmd&#39;:</span> <span class="err">&#39;response&#39;,</span>
  <span class="err">&#39;peers_onion&#39;:</span> <span class="p">{</span>
    <span class="err">29811:</span> <span class="err">[&#39;\xc7;A\xce\xbc\xd9O\xe2w&lt;Q&lt;&#39;],</span>
    <span class="err">59948:</span> <span class="err">[&#39;\xc7;A\xce\xbc\xd9O\xe2w&lt;Q&lt;&#39;]</span>
  <span class="p">}</span>
<span class="err">}</span>
</pre></div>


<h5 id="optional-file-id">Optional file id<a class="headerlink" href="#optional-file-id" title="Permanent link">&para;</a></h5>
<p>Integer representation of the first 4 character of the hash:</p>
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; int(&quot;ea2c2acb30bd5e1249021976536574dd3f0fd83340e023bb4e78d0d818adf30a&quot;[0:4], 16)
59948
</pre></div>


<hr />
<h4 id="checkport-port">checkport <em>port</em><a class="headerlink" href="#checkport-port" title="Permanent link">&para;</a></h4>
<p>Check requested port of the other peer.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>port</strong></td>
<td>Port which will be checked.</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>status</strong></td>
<td>Status of the port ("open" or "closed")</td>
</tr>
<tr>
<td><strong>ip_external</strong></td>
<td>External IP of the requestor</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="bigfile-plugin">Bigfile Plugin<a class="headerlink" href="#bigfile-plugin" title="Permanent link">&para;</a></h1>
<h4 id="getpiecefields-site">getPieceFields <em>site</em><a class="headerlink" href="#getpiecefields-site" title="Permanent link">&para;</a></h4>
<p>Returns all big file <a href="#bigfile-piecefield">piecefield</a> that client has for that site in a dict.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Requested site</td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>piecefields_packed</strong></td>
<td>Key: Bigfile's sha512/256 <a href="#bigfile-merkle-root">merkle root hash</a><br>Value: Packed <a href="#bigfile-piecefield">piecefield</a></td>
</tr>
</tbody>
</table>
<hr />
<h4 id="setpiecefields-site-piecefields_packed">setPieceFields <em>site</em>, <em>piecefields_packed</em><a class="headerlink" href="#setpiecefields-site-piecefields_packed" title="Permanent link">&para;</a></h4>
<p>Set the client's <a href="#picefield">piecefields</a> for that site.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>site</strong></td>
<td>Requested site</td>
</tr>
<tr>
<td><strong>piecefields_packed</strong></td>
<td>Key: Bigfile's sha512/256 <a href="#bigfile-merkle-root">merkle root hash</a><br>Value: Packed <a href="#bigfile-piecefield">piecefield</a></td>
</tr>
</tbody>
</table>
<p><strong>Return</strong>:</p>
<table>
<thead>
<tr>
<th>Return key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ok</strong></td>
<td>Updated</td>
</tr>
</tbody>
</table>
<h5 id="bigfile-piecefield">Bigfile piecefield<a class="headerlink" href="#bigfile-piecefield" title="Permanent link">&para;</a></h5>
<p>Holds the the big files downloaded pieces information in a simple string with 1/0 values. (1 = Downloaded, 0 = Not downloaded)</p>
<blockquote>
<p><strong>Example</strong>: <code>1110000001</code> means the file is sized 9-10MB and the client downloaded the first 3MB and the last 1MB at 1MB piecesize.</p>
</blockquote>
<p><strong>Packed format</strong>:</p>
<p>Turns the string to an list of int by counting the repeating characters starting with <code>1</code>.</p>
<blockquote>
<p><strong>Example</strong>: <code>1110000001</code> to <code>[3, 6, 1]</code>, <code>0000000001</code> to <code>[0, 9, 1]</code>, <code>1111111111</code> to <code>[10]</code></p>
</blockquote>
<p>After the conversion it turns it to more efficient <a href="https://docs.python.org/2/library/array.html">typed array</a> using <code>array.array('H', piecefield)</code></p>
<h5 id="bigfile-merkle-root">Bigfile merkle root<a class="headerlink" href="#bigfile-merkle-root" title="Permanent link">&para;</a></h5>
<p>During the big file hashing procedure, in addition to storing the per-piece sha512/256 hash digests in the <a href="#bigfile-piecemap">piecemap</a> file, the algorithm also calculates the SHA-512/256 merkle root of the file using the <a href="https://github.com/tierion/merkle-tools">merkle-tools</a> implementation.
The merkle root is only used as an ID to identify the big file, not (yet) for verifying the pieces.</p>
<blockquote>
<p><strong>Note</strong>: The merkle root is chosen to identify the file, instead of the file's actual SHA-512/256 hash. Obviously, using the latter results in hashing the same file twice. (once for piecemap once for the whole file)</p>
<p><strong>Note</strong>: The merkle root is not used to verify the integrity of the pieces or the big file, because doing so would take more bandwidth and space to transfer and store the merkle-proofs for partial verification, than the per-piece hash map file itself.</p>
</blockquote>
<h5 id="bigfile-piecemap">Bigfile piecemap<a class="headerlink" href="#bigfile-piecemap" title="Permanent link">&para;</a></h5>
<p>It holds the per-piece SHA-512/256 hashes. The piece size and the picemap filename is defined in <code>content.json</code>, eg.:</p>
<div class="codehilite"><pre><span></span>...
 &quot;files_optional&quot;: {
  &quot;bigfile.mp4&quot;: {
   &quot;piece_size&quot;: 1048576,
   &quot;piecemap&quot;: &quot;bigfile.mp4.piecemap.msgpack&quot;,
   &quot;sha512&quot;: &quot;d1f0d150e1e73bb1e684d370224315d7ba21e656189eb646ef7cc394d033bc2b&quot;,
   &quot;size&quot;: 42958831
  },
...
</pre></div>


<p>Having the following data structure, the piecemap file is packed into the <a href="https://msgpack.org/">msgpack</a> format:</p>
<div class="codehilite"><pre><span></span>{
  b&#39;bigfile.mp4&#39;: {b&#39;sha512_pieces&#39;: [
    b&quot;e\xde\x0fx\xec\xc5LZ9\x0e\xe7\x85E\x1b\xd5\xe4C&#39;\xe7req\xe3&lt;\xff\\\xbb\xc8b\xc2\xc1\x8e&quot;,
    b&#39;\xef\xe8\xed\xfe\x16/\x96\xdb;;\x06n[8_\x06\x9ak|\xe1\x9f\xe1\xaf\x87\x96\xdd\xfd\x9bEf\xd9!&#39;,
    b&#39;\x1c\xd6-\x1f\xce\xde{\xcd\x01\x93un =D\x0brmB-\xd1\x8c\xbf\xfe\xca\x8a\x1c\xf60\xbb\xedD&#39;,
    b&#39;\x1aQdF\xd2\xbc\xdff{\xb7\x89\xf2\xd3\r\xa9\xe1\xefA-V\x18\xa4\xc8e\x13\x88v\x13\\&amp;\xfbW&#39;,
    ...
  ]}
}
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../coding_conventions/" title="Coding standards if you want to collaborate to ZeroNet" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Précédent
                </span>
                Coding standards if you want to collaborate to ZeroNet
              </span>
            </div>
          </a>
        
        
          <a href="../donate/" title="Contribution financière" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Suivant
                </span>
                Contribution financière
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.6e01afa6.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../../../assets/javascripts/lunr/lunr.fr.js"></script>
              
            
          
          
        
      
      <script type="text/javascript">
        console.log("fr")
      </script>
      
        <script>app.initialize({version:"1.0.4",url:{base:"../../..", search_index_suffix: "fr"}})</script>
      
      
        <script src="../../../docs.js"></script>
      
        <script src="../../../jquery.min.js"></script>
      
        <script src="../../../javascript/menu.js"></script>
      
        <script src="../../../javascript/bitcoinbar.js"></script>
      
    
    
      
    
  </body>
</html>